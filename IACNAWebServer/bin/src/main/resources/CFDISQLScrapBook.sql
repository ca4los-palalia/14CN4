/**TRIGGER QUE ACTUALIZA LA INFORMACIÃ“N EN LA ENTIDAD HISTORIAL_PASSWORD*/
CREATE TRIGGER TR_PASS_UPDATER AFTER INSERT ON USUARIO
FOR EACH ROW
	BEGIN	
		DECLARE REGISTROS INT;
		DECLARE REG_MIN INT;
		DECLARE REG_MAX INT;
		DECLARE HOY DATETIME;
		SELECT COUNT(*) INTO REGISTROS FROM HISTORIAL_PASSWORD;
		SELECT NOW() INTO HOY;
		if REGISTROS is not null and REGISTROS > 2 then
		 	SELECT MIN(id_historial_password) INTO REG_MIN FROM HISTORIAL_PASSWORD;		 	
		 	DELETE FROM HISTORIAL_PASSWORD WHERE id_historial_password = REG_MIN;		 	
		 	INSERT INTO HISTORIAL_PASSWORD (fecha, fecha_modificacion,
		 	password, id_usuario)
		       VALUES (HOY, HOY, NEW.password, NEW.id_usuario);
		else
			INSERT INTO HISTORIAL_PASSWORD (fecha, fecha_modificacion,
		 		password, id_usuario)
		       	VALUES (HOY, HOY, NEW.password, NEW.id_usuario);
		end if;
	END

	-- DATOS DE EJEMPLO
	INSERT INTO DIRECCION VALUES (1, 'MIRADOR', 'PUEBLA', '72680', 'PUEBLA', 'PUEBLA', NOW(), 
	'SAN FRANCISCO', 'PUEBLA', '256', '256', 'MEXICO', NULL, NULL);	
	INSERT INTO CONTACTO VALUES(1, NOW(), NULL);
	INSERT INTO PERSONA VALUES (1, 'PALALIA', 'LOPEZ', NOW(), NOW(), 'CESAR', 'MASCULINO', NULL, 1, 1);
	INSERT INTO USUARIO VALUES (1, null, 'CSR.PLZ@GMAIL.COM', null, null, '5d8d90c9f5', '5D8D90C9F5', 1, null, 1);
	INSERT INTO USUARIO VALUES (2, null, 'A@B.COM', null, null, '123456789', '5D8D90C9F5', 1, null, 1);
	INSERT INTO USUARIO VALUES (3, null, 'CSR.PLZ.NEWS@GMAIL.COM', null, null, 'PALC880406', '123456789', 1, null, 1);
	INSERT INTO USUARIO VALUES (4, null, 'CSR.PLZ.NEWS@LIVE.DE', null, null, '505072949008', 'PACL880406', 1, null, 1);
	INSERT INTO USUARIO VALUES (5, null, 'PALMASOLANE@YAHOO.COM.MX', null, null, '85964', 'P59+525+65+', 1, null, 1);
	INSERT INTO USUARIO VALUES (6, null, 'CPLINC@LIVE.DE', null, null, '96584324564', 'PACL880406', 1, null, 1);
	--FIN DE LOS DATOS DE EJEMPLO
/**FIN DEL TRIGGER */
	

	

	
	